<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Sistema de Diagnóstico - Impresora HP DeskJet 2723</title>
  <style>
    /* Layout de dos columnas */
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: #f0f0f0;
    }

    .main-container {
      display: flex; /* Para columnas */
      min-height: 100vh;
    }

    /* Panel izquierdo: preguntas/conclusiones */
    .left-panel {
      flex: 2;
      background: #fff;
      padding: 20px;
    }

    /* Panel derecho: diagrama de flujo */
    .right-panel {
      flex: 1;
      background: #fafafa;
      border-left: 1px solid #ccc;
      padding: 20px;
      overflow-y: auto;
    }

    h1, h2 {
      text-align: center;
      margin-top: 0;
    }

    /* Estilos para la sección de preguntas */
    .question-container {
      max-width: 600px;
      margin: 0 auto;
      text-align: left;
    }

    .question {
      margin: 20px 0;
      font-size: 18px;
      font-weight: bold;
    }

    .answers {
      margin: 10px 0;
    }

    label {
      margin-right: 20px;
    }

    #nextBtn {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      background: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
    }
    #nextBtn:hover {
      background: #0056b3;
    }

    #result {
      margin-top: 30px;
      padding: 15px;
      background: #e0ffe0;
      border: 1px solid #00cc00;
      border-radius: 5px;
    }

    /* Estilos para el “diagrama de flujo” simplificado */
    .flow-node {
      padding: 10px;
      margin: 10px 0;
      border: 2px solid #ccc;
      border-radius: 4px;
      background: #fff;
      position: relative;
    }

    .flow-node h3 {
      margin: 0 0 5px 0;
      font-size: 16px;
      font-weight: bold;
    }

    .flow-node p {
      margin: 0;
      font-size: 14px;
    }

    /* Flecha entre nodos (opcional, simple) */
    .flow-arrow {
      width: 2px;
      height: 20px;
      background: #999;
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <div class="main-container">
    <!-- Panel Izquierdo: Preguntas / Conclusiones -->
    <div class="left-panel">
      <h1>Diagnóstico de la Impresora</h1>
      <div class="question-container" id="questionContainer">
        <!-- Aquí se inyectarán las preguntas y conclusiones dinámicamente -->
      </div>
    </div>

    <!-- Panel Derecho: Visualización de la red de inferencia (en tiempo real) -->
    <div class="right-panel">
      <h2>Línea de Razonamiento</h2>
      <div id="diagramContainer">
        <!-- Se mostrará el “camino” recorrido en la red de inferencia -->
      </div>
    </div>
  </div>

  <script>
    /***********************************************************************
     * 1. DEFINICIÓN DE NODOS (REGLAS Y CONCLUSIONES)
     ***********************************************************************/

    /*
      Cada nodo (objeto) tiene:
      - id: identificador único
      - type: "question" o "conclusion"
      - text: texto a mostrar
      - yes: id del siguiente nodo si la respuesta es "Sí"
      - no:  id del siguiente nodo si la respuesta es "No"
    */

    const nodes = {
      // Nodo inicial
      start: {
        id: "start",
        type: "question",
        text: "¿La impresora enciende correctamente?",
        yes: "q1",
        no: "c0"
      },

      // Conclusión si la impresora no enciende
      c0: {
        id: "c0",
        type: "conclusion",
        text: "Posible problema de alimentación. Verifique cable de alimentación, enchufe y botón de encendido."
      },

      // Pregunta 1
      q1: {
        id: "q1",
        type: "question",
        text: "¿La luz Wi-Fi está encendida (fija o parpadeando)?",
        yes: "q2",
        no: "c1"
      },

      // Conclusión: Luz Wi-Fi apagada
      c1: {
        id: "c1",
        type: "conclusion",
        text: "La impresora no está conectada a Wi-Fi. Reinicie el modo de configuración inalámbrica."
      },

      // Pregunta 2
      q2: {
        id: "q2",
        type: "question",
        text: "¿La luz Wi-Fi parpadea en azul?",
        yes: "c2",
        no: "q3"
      },

      // Conclusión: Modo configuración Wi-Fi
      c2: {
        id: "c2",
        type: "conclusion",
        text: "La impresora está en modo configuración. Use la app HP Smart para finalizar la conexión."
      },

      // Pregunta 3
      q3: {
        id: "q3",
        type: "question",
        text: "¿El indicador luminoso de tinta está encendido?",
        yes: "c3",
        no: "q4"
      },

      // Conclusión: Problema de tinta
      c3: {
        id: "c3",
        type: "conclusion",
        text: "El nivel de tinta es bajo o hay un problema con el cartucho. Revise o reemplace el cartucho."
      },

      // Pregunta 4
      q4: {
        id: "q4",
        type: "question",
        text: "¿La impresión sale borrosa o con rayas?",
        yes: "c4",
        no: "q5"
      },

      // Conclusión: Limpieza de cabezal
      c4: {
        id: "c4",
        type: "conclusion",
        text: "Los inyectores pueden estar obstruidos. Realice una limpieza del cabezal de impresión."
      },

      // Pregunta 5
      q5: {
        id: "q5",
        type: "question",
        text: "¿Hay un atasco de papel?",
        yes: "c5",
        no: "q6"
      },

      // Conclusión: Atasco de papel
      c5: {
        id: "c5",
        type: "conclusion",
        text: "Retire el papel atascado con cuidado y reinicie la impresora."
      },

      // Pregunta 6
      q6: {
        id: "q6",
        type: "question",
        text: "¿La impresora no responde a ningún comando?",
        yes: "c6",
        no: "q7"
      },

      // Conclusión: Reinicio general
      c6: {
        id: "c6",
        type: "conclusion",
        text: "La impresora podría necesitar un reinicio. Apáguela, espere 10 segundos y enciéndala de nuevo."
      },

      // Pregunta 7
      q7: {
        id: "q7",
        type: "question",
        text: "¿La calidad de impresión es mala (hojas en blanco o tinta irregular)?",
        yes: "q8",
        no: "c9"
      },

      // Pregunta 8
      q8: {
        id: "q8",
        type: "question",
        text: "¿El cartucho de color o negro está vacío?",
        yes: "c7",
        no: "c8"
      },

      // Conclusión: Reemplazar cartuchos
      c7: {
        id: "c7",
        type: "conclusion",
        text: "Reemplace el cartucho vacío o dañado y pruebe nuevamente."
      },

      // Conclusión: Revisar instalación cartuchos
      c8: {
        id: "c8",
        type: "conclusion",
        text: "Verifique que los cartuchos estén bien instalados y que el papel sea de buena calidad."
      },

      // Conclusión final si no se detectan problemas
      c9: {
        id: "c9",
        type: "conclusion",
        text: "No se detecta un problema específico según las respuestas. Consulte la guía de usuario o soporte de HP."
      }
    };

    /***********************************************************************
     * 2. GESTIÓN DE ESTADO
     ***********************************************************************/
    let currentNodeId = "start";

    // Este array guardará el camino recorrido: { nodeId, type, text, answer }
    // "answer" será la respuesta que llevó a este nodo ("yes", "no" o "start").
    const inferencePath = [];

    // Referencias al DOM
    const questionContainer = document.getElementById("questionContainer");
    const diagramContainer = document.getElementById("diagramContainer");

    /***********************************************************************
     * 3. FUNCIONES PARA RENDERIZAR NODOS Y DIAGRAMA
     ***********************************************************************/

    // Cargar un nodo (pregunta o conclusión) en el panel izquierdo
    function loadNode(nodeId, answer = "start") {
      currentNodeId = nodeId;
      const node = nodes[nodeId];

      // Limpia el contenedor de la pregunta/conclusión actual
      questionContainer.innerHTML = "";

      // 1) Agregamos este nodo al camino de inferencia
      inferencePath.push({
        nodeId: node.id,
        type: node.type,
        text: node.text,
        answer: answer
      });

      // 2) Actualizamos el diagrama a la derecha
      updateDiagram();

      // 3) Renderizamos la pregunta o la conclusión en el panel izquierdo
      if (node.type === "question") {
        // Crear el elemento de pregunta
        const questionEl = document.createElement("div");
        questionEl.classList.add("question");
        questionEl.textContent = node.text;
        questionContainer.appendChild(questionEl);

        // Crear las opciones de respuesta
        const answersEl = document.createElement("div");
        answersEl.classList.add("answers");
        answersEl.innerHTML = `
          <label>
            <input type="radio" name="answer" value="yes" /> Sí
          </label>
          <label>
            <input type="radio" name="answer" value="no" /> No
          </label>
        `;
        questionContainer.appendChild(answersEl);

        // Botón para continuar
        const nextBtn = document.createElement("button");
        nextBtn.id = "nextBtn";
        nextBtn.textContent = "Siguiente";
        nextBtn.addEventListener("click", () => {
          const selected = document.querySelector('input[name="answer"]:checked');
          if (!selected) {
            alert("Por favor, selecciona Sí o No.");
            return;
          }
          const userAnswer = selected.value; // "yes" o "no"
          goToNextNode(node, userAnswer);
        });
        questionContainer.appendChild(nextBtn);

      } else if (node.type === "conclusion") {
        // Mostrar la conclusión
        const conclusionEl = document.createElement("div");
        conclusionEl.id = "result";
        conclusionEl.innerHTML = `<h2>Conclusión:</h2><p>${node.text}</p>`;
        questionContainer.appendChild(conclusionEl);
      }
    }

    // Decidir el siguiente nodo según la respuesta
    function goToNextNode(node, answer) {
      // Obtenemos el id del siguiente nodo (según "yes" o "no")
      const nextId = (answer === "yes") ? node.yes : node.no;
      if (nextId) {
        loadNode(nextId, answer);
      } else {
        // Si no hay un nodo definido, mostramos un mensaje de error (caso raro)
        questionContainer.innerHTML = "<p>No se encontró el siguiente paso en la red de inferencia.</p>";
      }
    }

    // Renderizar la “línea de razonamiento” en el panel derecho
    function updateDiagram() {
      diagramContainer.innerHTML = "";

      inferencePath.forEach((step, index) => {
        // Creamos un recuadro para este paso
        const stepEl = document.createElement("div");
        stepEl.classList.add("flow-node");

        // Color según la respuesta que llevó a este nodo
        // - "start": nodo inicial (sin color especial)
        // - "yes": verde
        // - "no": rojo
        if (step.answer === "yes") {
          stepEl.style.borderColor = "green";
        } else if (step.answer === "no") {
          stepEl.style.borderColor = "red";
        }

        // Título y contenido
        if (step.type === "question") {
          stepEl.innerHTML = `
            <h3>Pregunta [${step.nodeId}]</h3>
            <p>${step.text}</p>
          `;
        } else {
          stepEl.innerHTML = `
            <h3>Conclusión [${step.nodeId}]</h3>
            <p>${step.text}</p>
          `;
        }

        // Agregamos el nodo al diagrama
        diagramContainer.appendChild(stepEl);

        // Si no es el último nodo, dibujamos una flecha (simple)
        if (index < inferencePath.length - 1) {
          const arrowEl = document.createElement("div");
          arrowEl.classList.add("flow-arrow");
          diagramContainer.appendChild(arrowEl);
        }
      });
    }

    /***********************************************************************
     * 4. INICIALIZACIÓN
     ***********************************************************************/
    // Cargar el nodo inicial
    loadNode(currentNodeId);
  </script>
</body>
</html>
